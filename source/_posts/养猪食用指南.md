---
title: 养猪食用指南
tags:
  - 笔记
  - Linux
categories: 笔记
cover: >-
  https://42f2671d685f51e10fc6-b9fcecea3e50b3b59bdc28dead054ebc.ssl.cf5.rackcdn.com/illustrations/pumpkin_re_bm46.svg
description: 养猪食用指南
abbrlink: e318ccac
top: 5
date: 2023-08-05 11:53:39
---
- 基于aapanel
- 本文纯100%抄袭
- 纯学习使用
- 无任何引导

# 安装aapanel
````markdown
wget https://raw.githubusercontent.com/Solmonz/aaPanel/main/script/aapanel.sh  -O aapanel.sh && chmod +x aapanel.sh && clear && ./aapanel.sh
````
### aapanerl 安装环境

- 选择使用LNMP的环境安装方式勾选如下信息
- Nginx 1.17
- MySQL 5.6
- PHP 7.4 
- 选择 Fast 快速编译后进行安装

### 安装Redis、fileinfo（有两个）

- aaPanel 面板 > App Store > 找到PHP 7.4点击Setting > Install extentions > 安装以下两个
- redis
- fileinfo

### 解除被禁止的函数

- aaPanel 面板 > App Store > 找到PHP 7.4点击Setting > Disabled functions  删除以下
- putenv
- proc_open
- pcntl_alarm
- pcntl_signal

### 添加站点

- aaPanel 面板 > Website > Add site
- 在 Domain 填入你指向服务器的域名
- 在 Database 选择MySQL
- 在 PHP Verison 选择PHP-74

### 安装V2Board

- 通过SSH登录到服务器后访问站点路径如：/www/wwwroot/你的站点域名
- 以下命令都需要在站点目录进行执行

### 删除目录下文件
```markdown
chattr -i .user.ini
rm -rf .htaccess 404.html index.html .user.ini
```
### 执行命令从 Github 克隆到当前目录。
```markdown
git clone https://github.com/v2board/v2board.git ./
```
### 执行命令安装依赖包以及V2board
```markdown
sh init.sh
```
- 根据提示完成安装

### .配置站点目录及伪静态

- 添加完成后编辑添加的站点 > Site directory > Running directory 选择 /public 保存
- 添加完成后编辑添加的站点 > URL rewrite 填入伪静态信息

```markdown
location /downloads {
}

location / {  
    try_files $uri $uri/ /index.php$is_args$query_string;  
}

location ~ .*\.(js|css)?$
{
    expires      1h;
    error_log off;
    access_log /dev/null; 
}
```
### 配置定时任务

- aaPanel 面板 > Cron
- 在 Type of Task 选择 Shell Script
- 在 Name of Task 填写 v2board
- 在 Period 选择 N Minutes 1 Minute
- 在 Script content 填写 php /www/wwwroot/路径/artisan schedule:run
- 根据上述信息添加每1分钟执行一次的定时任务

### 启动队列服务

- V2board的系统强依赖队列服务，正常使用V2Board必须启动队列服务。下面以aaPanel中supervisor服务来守护队列服务作为演示
- aaPanel 面板 > App Store > Tools
- 找到Supervisor进行安装，安装完成后点击设置 > Add Daemon按照如下填写 
- 在 Name 填写 V2board
- 在 Run User 选择 www
- 在 Run Dir 选择 站点目录 在 Start Command 填写 php artisan horizon 在 Processes 填写 1
- 填写后点击Confirm添加即可运行

### 给文件夹权限
```markdown
chmod 777 /文件夹名
```
# 后端相关

## 安装bbr

- 通过SSH连接上你的Linux服务器，推荐使用CentOS7
- 安装内核加速，推荐使用bbr plus。先安装内核，选择2，重启后，开启加速，选择7
- 看自己vps 具体情况

```markdown
wget -N --no-check-certificate "https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh"
chmod +x tcp.sh
./tcp.sh
```
## 同步一下时间

```markdown
apt - y install ntpdate
timedatectl set-timezone Asia/Shanghai
ntpdate pool.ntp.org
```
## 关闭防火墙
````markdown
systemctl start supervisord
systemctl disable firewalld
systemctl stop firewalld
````
# soga

```markdown
# 自动安装最新版
bash <(curl -Ls https://raw.githubusercontent.com/vaxilu/soga/master/install.sh)
# 安装指定版本
bash <(curl -Ls https://raw.githubusercontent.com/vaxilu/soga/master/install.sh) x.x.x
```
- 开心版

```markdown
bash < <(curl -Ls https://raw.githubusercontent.com/enxier/crack-soga/main/install.sh)
```
- 模板

```markdown
# 基础配置
type=v2board   ## 对接的面板类型，可选v2board/sspanel/vnetpanel
server_type=ss  ## 对接的节点类型
node_id=4      ## 前端节点id
soga_key=       ## 授权密钥，社区版无需填写，最多支持88用户，商业版无限制

# webapi 或 db 对接任选一个
api=webapi    ## 对接的方式，可选webapi 或 db，表示 webapi 对接或数据库对接

# webapi 对接信息
webapi_url=https://xxxxx.xxx/ ## 面板域名地址
webapi_key=xxxxxxxxxxxx    ## 面板设置的通讯密钥
 
# db 对接信息
db_host=    ## 数据库地址
db_port=     ## 数据库端口
db_name=    ## 数据库名
db_user=    ## 数据库用户名
db_password=  ## 数据库密码

# 手动证书配置
cert_file=   # 这里是用到tls,使用申请证书的域名  （如不使用tls，这行可以删除不用）
key_file=       # 这里是用到tls,使用申请证书的域名  （如不使用tls，这行可以删除不用）

# 自动证书配置
cert_mode=      # 申请模式   （如不使用tls，这行可以删除不用）
cert_domain=   # 这里是用到tls,使用申请证书的域名  （如不使用tls，这行可以删除不用）
cert_key_length=ec-256  # 留空则申请RSA证书，填写ec-256或ec-384则申请ECC证书（如不使用tls，这行可以删除不用）

# dns 配置
default_dns=8.8.8.8,1.1.1.1 ## 配置默认dns，可在此配置流媒体解锁的dns，以逗号分隔
dns_cache_time=10
dns_strategy=ipv4_first

# v2ray 特殊配置
v2ray_reduce_memory=false
vless=false
vless_flow=

# proxy protocol 中转配置
proxy_protocol=false

# 全局限制用户 IP 数配置
redis_enable=false
redis_addr=
redis_password=
redis_db=0
conn_limit_expiry=60

# 其它杂项
user_conn_limit=0   ## 限制用户连接数，0代表无限制，v2board 必填！！！
user_speed_limit=0   ## 用户限速，0代表无限制，单位 Mbps，v2board 必填！！！
node_speed_limit=0
check_interval=60   ## 同步前端用户、上报服务器信息等间隔时间（秒），近似值
force_close_ssl=false
forbidden_bit_torrent=true   ## 设为true可强制关闭tls，即使前端开启tls，soga也不会开启tls，方便用户自行使用nginx、caddy等反代
log_level=info

# 更多配置项如有需要自行添加
## forbidden_bit_torrent=true ## 设为true可禁用bt下载
```
## docker版本

```dockerfile
docker run --restart=on-failure --name changenamehere -d \
-v /etc/soga/:/etc/soga/ --network host \
-e type=v2board \
-e server_type=v2ray \
-e node_id=5 \
-e soga_key=nonono \
-e api=webapi \
-e webapi_url=https://xxxx.net \
-e webapi_key=lolsodksjsnsn \
-e cert_file= \
-e key_file= \
-e cert_domain= \
-e cert_mode= \
-e cert_key_length= \
-e dns_provider= \
-e DNS_CF_Email= \
-e DNS_CF_Key= \
-e default_dns=8.8.8.8,1.1.1.1 \
-e dns_cache_time=10 \
-e dns_strategy=ipv4_first \
-e proxy_protocol=false \
-e force_proxy_protocol=false \
-e redis_enable=true \
-e redis_addr=xxxxx:10001 \
-e redis_password=test \
-e redis_db=0 \
-e conn_limit_expiry=60 \
-e user_conn_limit=3 \
-e user_speed_limit=0 \
-e node_speed_limit=0 \
-e check_interval=60 \
-e force_close_ssl=true \
-e forbidden_bit_torrent=true \
vaxilu/soga
```
## docker-compose

````dockerfile
version: '3'
services:
  soga:
    container_name: changenamehere
    restart: on-failure
    image: vaxilu/soga
    network_mode: host
    volumes:
      - /etc/soga/:/etc/soga/
    environment:
      - type=v2board
      - server_type=ss
      - node_id=
      - soga_key=
      - api=webapi
      - webapi_url=
      - webapi_key=
      - cert_file=
      - key_file=
      - cert_domain=
      - cert_mode=
      - cert_key_length=
      - dns_provider=
      - DNS_CF_Email=
      - DNS_CF_Key=
      - default_dns=8.8.8.8,1.1.1.1
      - dns_cache_time=10
      - dns_strategy=ipv4_first
      - proxy_protocol=false
      - force_proxy_protocol=false
      - redis_enable=true
      - redis_addr=1xxx3:xxxx
      - redis_password=test
      - redis_db=0
      - conn_limit_expiry=60
      - user_conn_limit=3
      - user_speed_limit=0
      - node_speed_limit=0
      - check_interval=60
      - force_close_ssl=true
      - forbidden_bit_torrent=true
````
- 基础配置（必填）

````ts

参数名	      默认值	            说明
type	     sspanel-uim	    sspanel-uim,v2board,whmcs,proxypanel
server_type 	v2ray	     v2ray,trojan,ss,ssr
node_id	无	节点 id，可配置多个(v2.7.1+)，以逗号分隔: 1,2,3
soga_key	无	授权码，社区版无需填写
api	webapi	对接方式，weapi 或 db，任选一个，推荐 webapi
````
- 对接配置（必填）
- webapi 和 db 对接信息只需填一方的信息

```ts
参数名	默认值	说明
webapi_url	无	面板 webapi 地址，一般就是主页地址
webapi_mukey	无	webapi 通信密钥，不推荐使用，请使用webapi_key
webapi_key	无	webapi 通信密钥
–	 	 
db_host	无	数据库地址
db_port	3306	数据库端口
db_name	无	数据库名
db_user	root	数据库用户名
db_password	无	数据库密码
db_max_idle_time	480	连接最多空闲时间，单位分钟
db_max_idle_conn	4	最大空闲连接数
db_max_conn	4	最大连接数
```

- dns 配置（可选）

```ts
参数名	默认值	说明
default_dns	无	要使用的 dns 地址，以逗号分隔，也支持域名 dns，不填则使用系统 dns 解析
dns_cache_time	10	dns 缓存时间，单位分钟
dns_strategy	ipv4_first	dns 解析策略，可选：ipv4_first、ipv4_only、ipv6_first、ipv6_only
```

- v2ray 特殊配置（可选）

````ts
参数名	默认值	说明
v2ray_reduce_memory	false	VMessMd5 下有效，大幅降低内存使用，启用后客户端时间误差建议不超过15秒，最多不超过25秒
vless	false	是否启用 vless 协议
vless_flow	无	vless 流控，具体请参考 v2ray 官方文档
v2ray_fallback_addr	无	v2ray 回落地址，vless+tcp+tls 或 vmess+tcp+tls 下有效，若开启，则同时需设置 tls_alpn=http/1.1
v2ray_fallback_port	无	v2ray 回落端口，vless+tcp+tls 或 vmess+tcp+tls 下有效
force_vmess_aead	false	v2.7.2+，是否强制启用 VMessAEAD，强制启用后，alterId 将被忽略，用户只能使用 VMessAEAD 进行连接
````

- trojan 特殊配置（可选）

```ts
trojan_remote_addr	无	trojan 回落地址，若开启，则同时需设置 tls_alpn=http/1.1
trojan_remote_port	无	trojan 回落端口
```

- tls 配置（可选）

```ts

参数名	默认值	说明
tls_alpn	h2,http/1.1	TLS ALPN 配置，不懂的话保持默认即可，多协议以逗号分隔
xtls	false	设为 true 即可开启 xtls，目前仅在 vless+tcp+tls 时有效，开启 xtls 后同时需要设置 vless_flow=xtls-rprx-direct
tls_min_version	空	tls 最低版本，可选：1.0，1.1，1.2，1.3
tls_max_version	空	tls 最高版本，可选：1.0，1.1，1.2，1.3
tls_prefer_server_cipher_suites	true	如果为 true 则为使用服务器的最优选的密码套件
tls_cipher_suites	空	配置加密套件，参考 tls 加密套件配置
```
# XrayR

```markdown
bash <(curl -Ls https://raw.githubusercontent.com/XrayR-project/XrayR-release/master/install.sh)
```
## 本地审计规则
只有v2ray才能用

```markdown
waget https://github.com/Solmonz/sam_Subconverter/blob/92e46bdfc75543b96c452575e00b5af4331ffbd9/Sub/XrayR.zip
unzip XrayR.zip
unzip XrayR.zip -d /etc/XrayR
```

- [v2](https://v2board.com/deploy/aapanel.html)
- [soga](https://blog.miaocy.cc/165.html)
- [XrayR](https://xrayr-project.github.io/XrayR-doc/xrayr-pei-zhi-wen-jian-shuo-ming/config.html)
- [v2审计规则](https://github.com/Solmonz/sam_Subconverter/blob/adad231a8c3206f56c5c1a9f184984dddd60db3b/Sub/blockList)

# lnmp 安装

## 拉取2.0 lnmp

- 2.0后官方版本有毒
- 拉取他人备份

```markdown
wget --no-check-certificate https://lnmp.oceans.eu.org/lnmp2.0-full.tar.gz
```

- 自己：https://lnmp.oceans.eu.org/lnmp2.0-full.tar.gz
- 需要什么后面加版本号： 0.6、0.7、0.8、0、9    1.9  2.0 :提供以上几个版本
- 解压
- 网络收集：http://srv.bofeng.org/lnmp2.0-full.tar.gz

```markdown
tar -xvf lnmp2.0-full.tar.gz
```

## 离线安装

- 网址：https://lnmp.org/auto.html


```markdown

tar zxf lnmp2.0-full.tar.gz && cd /root/lnmp2.0-full && LNMP_Auto="y" DBSelect="4" Bin="y" DB_Root_Password="密码" InstallInnodb="y" PHPSelect="10" SelectMalloc="1" CheckMirror="n" ./install.sh lnmp
```


-  MySQL版本 5.6
- 二进制安装MySQL
- 数据库密码
- PHP 版本7.4
- 离线安装选 '是'


## 安装缓存加速类扩展

```markdown
安装命令：./addons.sh install XXXX
卸载命令：./addons.sh uninstall  XXX

列：   
./addons.sh install fileinfo
       
./addons.sh install redis 

# 也可以手动选择  输入序列号选择你要安装的    
./addons.sh       

```

- 检查是否安装及运行成功

```shell
# redis
systemctl status redis

# fileinfo
php -m | grep fileinfo

```

- 扩展 不一定使用

```shell
# 查看可执行文件路径
sudo find / -type f -name "redis-server"

# 比如路径在: /usr/local/redis/bin/redis

/usr/local/redis/bin/redis-server --version

#添加到 $PATH

export PATH=$PATH:/usr/local/redis/bin

# 查看是否安装成功

redis-server --version

# 最后启动后台运行加 --daemonize yes

/usr/local/redis/bin/redis-server 

```

## 删除函数'putenv proc_open pcntl_alarm pcntl_signal'

```markdown
sed -i 's/,system//g' /usr/local/php/etc/php.ini
sed -i 's/,proc_open//g' /usr/local/php/etc/php.ini
sed -i 's/,proc_get_status//g' /usr/local/php/etc/php.ini
```

## 新建数据库

- IP/phpmyadmin
- 登录后 新建一个相同名字的上传数据库 "比如 test"

### 还需要手动上传一次

```markdown
1、unzip /root/test/test.zip
2、mysql -u your_username -p   ‘your_username = 自己的库账号 比如 root’
- 输入密码
3、USE test;
4、source /root/test/test;
5、exit;
```

### 简单粗暴直接命令上传  略过手动上传 

- 手动上传数据库 到目录

```bash
mysql -u root -p 数据库名字 < /root/test/数据库名字 --force
```
### 或者手动删除数据库 然后在导入

```shell
#登录数据库
mysql -u root -p

# 删除整个数据库
DROP DATABASE 数据库名字;

# 创建新的数据库
CREATE DATABASE 数据库名字;

# 退出
exit;

# 重新导入
mysql -u root -p 数据库名字 < /root/test/数据库名字

```

- SHOW DATABASES; "查看全部数据库名称"
- service mysql restart "重启数据库管理系统"

# 创建面板网站

```markdown
lnmp vhost add  ##新建网站
lnmp vhost del  ##删除网站
lnmp vhost list ##列出所有网站
```

- include rewrite/other.conf;  other改thinkphp

- 示例
```shell
Please enter domain(example: www.lnmp.org): xxxx.com ## 网址
 Your domain: xxx.com
Enter more domain name(example: lnmp.org sub.lnmp.org):  # 是否需要绑定多个域名，多个域名空格分开
 domain list: xxx.com 
Please enter the directory for the domain:  xxx.com 
Default directory: /home/wwwroot/ xxx.com : 
Virtual Host Directory: /home/wwwroot/ xxx.com  ## 网址位置
Allow Rewrite rule? (y/n) y #是否开启伪静态
Please enter the rewrite of programme, 
wordpress,discuzx,typecho,thinkphp,laravel,codeigniter,yii2,zblog rewrite was exist.
(Default rewrite: other): thinkphp #伪静态规则文件名，这里使用的 thinkphp
You choose rewrite: thinkphp
Enable PHP Pathinfo? (y/n) n # 是否启动Pathinfo
Disable pathinfo.
Allow access log? (y/n) y #是否启动log 
Enter access log filename(Default:xxxx.com.log): xxxx
You access log filename: xxxx.log
Enable IPv6? (y/n) n
Disabled IPv6 Support in current Virtualhost.
Create database and MySQL user with same name (y/n) n # 是否添加用户数据库
Enter current root password of Database (Password will not shown):  ## 上面没选的话就不用 输入。密码是数据库密码
OK, MySQL root password correct.
Enter database name: xxx # 新建的数据库和用户名
Your will create a database and MySQL user with same name: xxx
Please enter password for mysql user ocean: xxxxxxx  # 数据库密码
Your password: ocean.com 
Add SSL Certificate (y/n) y 是否启动证书
1: Use your own SSL Certificate and Key
2: Use Let's Encrypt to create SSL Certificate and Key
3: Use BuyPass to create SSL Certificate and Key
4: Use ZeroSSL to create SSL Certificate and Key
Enter 1, 2, 3 or 4: 2 # 选项1是代表使用自己准备的证书，选项2是使用免费的SSL证书提供商Letsencrypt提供的证书
Using 301 to Redirect HTTP to HTTPS? (y/n) y
```
```shell

# 一般在这个位置
/usr/local/nginx/conf/rewrite
```
# 拉取安装跟上面一样就行

# 防跨目录设置

```bash
sed -i 's/^fastcgi_param PHP_ADMIN_VALUE/#fastcgi_param PHP_ADMIN_VALUE/g' /usr/local/nginx/conf/fastcgi.conf
```
## 重启 nginx php

```shell
lnmp nginx reload
```

#  配置计划任务

```bash
crontab -e
##打开在后面编辑添加下面一行，代表每隔1分钟执行一次任务
*/1 * * * * php /home/wwwroot/站点文件名/artisan schedule:run
````

# 队列服务

- node -v
- npm -v
- pm2 -v

```bash
sudo apt update && sudo apt install nodejs npm && npm -v && npm install -g pm2 && pm2 -v
```
```bash
pm2 start "pm2.yaml" --name v2board
```

## 给网站755权限

```shell
chmod -R 755 /home/wwwroot/域名
chown -R www:www /home/wwwroot/域名
```

### 报修修正参考命令

- chown -R www:www *
- chmod -R 755 *
- 报错：建议检查redis 文件权限、或者查看日志 

```shell
lnmp status

systemctl status redis
```

- 日志查看命令
-  /etc/init.d/php-fpm restart  #重启php
- lnmp nginx reload  #重启nginx
- lnmp restart  #重启lnmp

# 队列

```shell
pm2 logs V2Board
```

- 重启队列
 
```shell
cd /home/wwwroot/域名

php artisan queue:restart

pm2 start "pm2.yaml" --name v2board
``` 

# 感谢
[参考1](https://getzhuji.com/5747.html)
[参考2](https://www.wenzika.com/2465.html)
